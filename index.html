<!doctype html><html><head lang=en><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Happy Coding | Home</title><link rel=icon type=image/png href=favicon.ico><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta property="og:image" content="//tywhisky.github.io/"><link rel=alternate type=application/rss+xml href=//tywhisky.github.io/index.xml title="Happy Coding"><meta property="og:url" content="//tywhisky.github.io/"><meta property="og:site_name" content="Happy Coding"><meta property="og:title" content="Happy Coding"><meta property="og:locale" content="en_us"><meta property="og:type" content="website"><meta name=twitter:card content="summary"><meta name=twitter:title content="Happy Coding"><link href=//tywhisky.github.io/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=//tywhisky.github.io/css/main.a87126a5d38398207e58225b2d1a9faf97f546982f44b3ffb9715a264da36c90.css><link id=darkModeStyle rel=stylesheet type=text/css href=//tywhisky.github.io/css/dark.f163b79c6de51d14a766ff9f0563053de7f06a4d1bf7b85a59608bf96e566710.css media="(prefers-color-scheme: dark)"><script type=text/javascript src=//tywhisky.github.io/js/MathJax.js></script><script type=text/x-mathjax-config>
		MathJax.Hub.Config({
			tex2jax: {
				inlineMath: [['$','$'], ['\\(','\\)']],
				displayMath: [['$$','$$'], ['\[','\]']],
				processEscapes: true,
				processEnvironments: true,
				skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
				TeX: { equationNumbers: { autoNumber: "AMS" },
						 extensions: ["AMSmath.js", "AMSsymbols.js"] }
			}
		});
		</script><link rel=stylesheet href=//tywhisky.github.io/katex/katex.min.css><script defer src=//tywhisky.github.io/katex/katex.min.js></script><script defer src=//tywhisky.github.io/katex/auto-render.min.js onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script></head><body><div class=content><header><div class=main><a href=//tywhisky.github.io/>Happy Coding</a></div><nav><a href=//tywhisky.github.io/>Home</a>
<a href=//tywhisky.github.io/posts>All posts</a>
<a href=//tywhisky.github.io/about>About</a>
<a href=//tywhisky.github.io/tags>Tags</a></nav></header><main class=list><div class=site-description><p>Hey, I am TianYu, a web developer with fanatical code cleanliness. Growing up, living, and working in Shanghai. It&rsquo;s an honour to me that you here. This blog is made up with Emacs (Org mode) and Hugo, it is used to record my life, study and programming. Feel free to linger and explore! Outside of programming, I enjoy playing badminton and video games with any type. If you are interested in these too, I would be glad to chat with you!</p></div><section class=list-item><h1 class=title><a href=//tywhisky.github.io/posts/my-first-work-on-open-source-for-elixir/>记一次在 Elixir 上的开源工作</a></h1><time>Aug 4, 2024</time><br><div class=description><p>前几天在闲暇之余浏览 Github ，发现不少开源项目都存在大量的 Issue 和 Pull Request 没有得到解决。这其实也是比较正常的情况，对于大多数没有稳定收入来源的开源项目来说，你不能要求核心团队提供任何多余的服务，而是应该发起一个 PR 来帮助项目的成长。于是我突然想起了 Elixir ，这门我已经写了 3 年，在我心中最适合 Web 开发的函数式编程，也许我也有什么能帮上忙的说不定。</p><p>令我惊讶的是，Elixir 的 Issue 仅有 20 条左右，PR 也仅有 5 条以内，并且很多陈年老 Issue ，原因可能一方面是 Elixir 经过了 10 年多的迭代进入了稳定期，更重要的原因那就是创始人 José Valim 和他的团队铁人般的提交数量，整个 Elixir 项目，José Valim 一人就提供了接近 5000 的 commits ，断崖领先其他人。而除了 Elixir 外，他也是 Phoenix/Livebook 等一系列核心生态项目的主力负责人和开发者。</p><p>Issue 列表中每一条都有 José Valim 的回复并且打上了各种标签著名 Issue 类型，有些是需要 Issue OP 提供更多信息的 bug ，有些则是简单的 Feature 描述，还有一些 Chores 相关的杂活，整体 Issue 都比较清晰。我浏览 Issue 列表发现了一个 bug 标签的帖子，主要问题是：</p><blockquote><p><em>当前 IEx 中对于三种 `normal` 类型的 EXIT 信号不会提供任何报错信息，José Valim 的目标是将这些报错信息全部展示（尽管可能会造成一些报错信息的重复）。</em></p>&mldr;</div><a class=readmore href=//tywhisky.github.io/posts/my-first-work-on-open-source-for-elixir/>Read more ⟶</a></section><section class=list-item><h1 class=title><a href=//tywhisky.github.io/posts/design-pattern-in-elixir/>[Note] Design Patterns in Elixir</a></h1><time>May 25, 2024</time><br><div class=description><p>This is a review note for José Valim's speech on <a href="https://www.youtube.com/watch?v=agkXUp0hCW8">YouTube</a></p><div id=outline-container-headline-1 class=outline-2><h2 id=headline-1>What's Design Pattern</h2><div id=outline-text-headline-1 class=outline-text-2><p>A famous pic from <a href=https://www.slideshare.net/slideshow/fp-patterns-ndc-london2013/42373281>Functional Programming Patterns (NDC London 2013)</a></p><p><img src=//tywhisky.github.io/pattern-design-between-oop-and-fp.png alt=/pattern-design-between-oop-and-fp.png title=/pattern-design-between-oop-and-fp.png></p><p>But this might cause some misunderstandings about design patterns. An OOP programmer might think: 'Look, how clearly design patterns are defined!' Meanwhile, an FP programmer might think: 'Oh, functional programming is much better than OOP programming. There are no design patterns, everything is just functions!'</p>&mldr;</div><a class=readmore href=//tywhisky.github.io/posts/design-pattern-in-elixir/>Read more ⟶</a></section><section class=list-item><h1 class=title><a href=//tywhisky.github.io/posts/partition-and-shading-on-postgresql/>PostgreSQL 分区和分片</a></h1><time>Jan 10, 2024</time><br><div class=description><div id=outline-container-headline-1 class=outline-2><h2 id=headline-1>分区</h2><div id=outline-text-headline-1 class=outline-text-2><p>分区表并不是每天都要用到的，但在某些情况下，尤其是当你有一个预计会不断增长的大容量表时，分区表就显得尤为重要。</p><p>在 PostgreSQL 下拥有 Hot Table 隐患时进行删除操作是很灾难性的，一个长期运行的查询将会遍历每一条数据，标记为 dead 后执行操作，在这过程中不会释放任何空间。但有了分区，删除就变成了简单的 DROP TABLE。 它可以立即执行，成本可以忽略不计（分区还有其他好处）。当然，代价是需要重点维护。</p><div id=outline-container-headline-2 class=outline-3><h3 id=headline-2>分区操作</h3><div id=outline-text-headline-2 class=outline-text-3><p>– 列出所有已存在的表</p><p>– 决定应创建哪些新分区（如果有的话）并创建它们，提前三天将未来的分区调出来，为操作提供一些缓冲，以防出错。</p><div class="src src-sql"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> widget_20221005 PARTITION <span style=color:#66d9ef>OF</span> widget
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>FOR</span> <span style=color:#66d9ef>VALUES</span> <span style=color:#66d9ef>FROM</span> (<span style=color:#e6db74>&#39;2022-10-05&#39;</span>) <span style=color:#66d9ef>TO</span> (<span style=color:#e6db74>&#39;2022-10-06&#39;</span>);</span></span></code></pre></div></div><div class="src src-sql"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> widget DETACH partition widget_20221005;</span></span></code></pre></div></div><div class="src src-sql"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>DROP</span> <span style=color:#66d9ef>TABLE</span> widget_20221005;</span></span></code></pre></div></div><p>INSERT 和 UPDATE 都发生在父表上，因此分区完全从正常的应用程序逻辑中抽象出来。这样我们就完成了一次简单的分区操作。</p></div></div></div></div><div id=outline-container-headline-3 class=outline-2><h2 id=headline-3>分片</h2><div id=outline-text-headline-3 class=outline-text-2><p>一种将 Postgres 数据库表分割成更小表的技术，通常用于在组成数据库实例集群的多个节点上横向分发数据，更多部署在多节点集群。</p><div id=outline-container-headline-4 class=outline-3><h3 id=headline-4>使用 Citus 分片操作</h3><div id=outline-text-headline-4 class=outline-text-3><div class="src src-sql"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>create</span> extension citus;</span></span></code></pre></div></div><div class="src src-sql"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> create_distributed_table(<span style=color:#e6db74>&#39;table&#39;</span>, <span style=color:#e6db74>&#39;shard_column&#39;</span>, shard_count :<span style=color:#f92672>=</span> <span style=color:#ae81ff>256</span>);</span></span></code></pre></div></div><div class="src src-sql"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> citus_add_node(<span style=color:#e6db74>&#39;worker_node_address&#39;</span>, <span style=color:#e6db74>&#39;192.168.0.2&#39;</span>);</span></span></code></pre></div></div><div class="src src-sql"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-sql data-lang=sql><span style=display:flex><span>rebalance:
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> rebalance_table_shards();</span></span></code></pre></div></div><p>除了简单方便外，使用 Citus 分片的好处还有性能：由于分片本质上也是散列分区的一种形式，因此分区的一些性能优势也适用于分片。 特别是，autovacuum 会在集群中的所有 Citus 分片上并行运行。</p>&mldr;</div><a class=readmore href=//tywhisky.github.io/posts/partition-and-shading-on-postgresql/>Read more ⟶</a></section><ul class=pagination><span class="page-item page-prev"></span><span class="page-item page-next"><a href=//tywhisky.github.io/page/2/ class=page-link aria-label=Next><span aria-hidden=true>Next →</span></a></span></ul></main><footer><div style=display:flex><a class=soc href=https://github.com/tywhisky rel=me title=GitHub><svg class="feather"><use href="//tywhisky.github.io/svg/feather-sprite.51cf5647cb1987f769b616558f2620fd9423d72058490231b391bf6aa3744b55.svg#github"/></svg></a><a class=border></a></div><div class=footer-info>2026 Tainef | <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></footer></div></body></html>