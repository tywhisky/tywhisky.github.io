<!doctype html><html><head lang=en><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Happy Coding | Home</title><link rel=icon type=image/png href=favicon.ico><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta property="og:image" content="//tywhisky.github.io/"><link rel=alternate type=application/rss+xml href=//tywhisky.github.io/index.xml title="Happy Coding"><meta property="og:url" content="//tywhisky.github.io/"><meta property="og:site_name" content="Happy Coding"><meta property="og:title" content="Happy Coding"><meta property="og:locale" content="en_us"><meta property="og:type" content="website"><meta name=twitter:card content="summary"><meta name=twitter:title content="Happy Coding"><link href=//tywhisky.github.io/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=//tywhisky.github.io/css/main.a87126a5d38398207e58225b2d1a9faf97f546982f44b3ffb9715a264da36c90.css><link id=darkModeStyle rel=stylesheet type=text/css href=//tywhisky.github.io/css/dark.f163b79c6de51d14a766ff9f0563053de7f06a4d1bf7b85a59608bf96e566710.css media="(prefers-color-scheme: dark)"><script type=text/javascript src=//tywhisky.github.io/js/MathJax.js></script><script type=text/x-mathjax-config>
		MathJax.Hub.Config({
			tex2jax: {
				inlineMath: [['$','$'], ['\\(','\\)']],
				displayMath: [['$$','$$'], ['\[','\]']],
				processEscapes: true,
				processEnvironments: true,
				skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
				TeX: { equationNumbers: { autoNumber: "AMS" },
						 extensions: ["AMSmath.js", "AMSsymbols.js"] }
			}
		});
		</script><link rel=stylesheet href=//tywhisky.github.io/katex/katex.min.css><script defer src=//tywhisky.github.io/katex/katex.min.js></script><script defer src=//tywhisky.github.io/katex/auto-render.min.js onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script></head><body><div class=content><header><div class=main><a href=//tywhisky.github.io/>Happy Coding</a></div><nav><a href=//tywhisky.github.io/>Home</a>
<a href=//tywhisky.github.io/posts>All posts</a>
<a href=//tywhisky.github.io/about>About</a>
<a href=//tywhisky.github.io/tags>Tags</a></nav></header><main class=list><div class=site-description><p>Hey, I am TianYu, a web developer with fanatical code cleanliness. Growing up, living, and working in Shanghai. It&rsquo;s an honour to me that you here. This blog is made up with Emacs (Org mode) and Hugo, it is used to record my life, study and programming. Feel free to linger and explore! Outside of programming, I enjoy playing badminton and video games with any type. If you are interested in these too, I would be glad to chat with you!</p></div><section class=list-item><h1 class=title><a href=//tywhisky.github.io/posts/note-about-task/>`Task.await/2` and `Task.await_many/2`</a></h1><time>Mar 15, 2023</time><br><div class=description><div id=outline-container-headline-1 class=outline-2><h2 id=headline-1>Introduction</h2><div id=outline-text-headline-1 class=outline-text-2><p>These days, I received a requirement to call several APIs simultaneously. It's common sense to use Task for this purpose, and I naturally gravitated towards using it. However, I came across Task.yield/2 and wondered about the difference between it and Task.await. Let's explore this.</p><div id=outline-container-headline-2 class=outline-3><h3 id=headline-2>Look some code snippets</h3><div id=outline-text-headline-2 class=outline-text-3><div class="src src-elixir"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-elixir data-lang=elixir><span style=display:flex><span><span style=color:#66d9ef>for</span> ms <span style=color:#f92672>&lt;-</span> [<span style=color:#ae81ff>2_000</span>, <span style=color:#ae81ff>4_000</span>, <span style=color:#ae81ff>6000</span>] <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Task</span><span style=color:#f92672>.</span>async(<span style=color:#66d9ef>fn</span> <span style=color:#f92672>-&gt;</span> <span style=color:#a6e22e>Process</span><span style=color:#f92672>.</span>sleep(ms); ms <span style=color:#66d9ef>end</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|&gt;</span> <span style=color:#a6e22e>Enum</span><span style=color:#f92672>.</span>map(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>Task</span><span style=color:#f92672>.</span>await(&amp;1, <span style=color:#ae81ff>3000</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># return [2000, 4000, 6000]</span></span></span></code></pre></div></div><div class="src src-elixir"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-elixir data-lang=elixir><span style=display:flex><span><span style=color:#66d9ef>for</span> ms <span style=color:#f92672>&lt;-</span> [<span style=color:#ae81ff>2_000</span>, <span style=color:#ae81ff>4_000</span>, <span style=color:#ae81ff>6_000</span>] <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Task</span><span style=color:#f92672>.</span>async(<span style=color:#66d9ef>fn</span> <span style=color:#f92672>-&gt;</span> <span style=color:#a6e22e>Process</span><span style=color:#f92672>.</span>sleep(ms); ms <span style=color:#66d9ef>end</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|&gt;</span> <span style=color:#a6e22e>Task</span><span style=color:#f92672>.</span>yield_many(<span style=color:#ae81ff>3000</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># return ** (EXIT) time out</span></span></span></code></pre></div></div></div></div><div id=outline-container-headline-3 class=outline-3><h3 id=headline-3>Summary</h3><div id=outline-text-headline-3 class=outline-text-3><p>If you use await in Enum.map/2, each await picks up after the previous one finishes with a fresh 3-second timeout. Since each task blocks for 2 seconds before finishing, no timeout is triggered, but the total runtime exceeds the expected duration.</p>&mldr;</div><a class=readmore href=//tywhisky.github.io/posts/note-about-task/>Read more ⟶</a></section><section class=list-item><h1 class=title><a href=//tywhisky.github.io/posts/trap-of-map-update/>Trap Of `Map.update/4`</a></h1><time>Jan 13, 2023</time><br><div class=description><p>If we want to update a value in a map of which key we can not ensure it's exist.
We can get the two way quickly:</p><div class="src src-elixir"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-elixir data-lang=elixir><span style=display:flex><span> record <span style=color:#f92672>=</span> <span style=color:#a6e22e>Map</span><span style=color:#f92672>.</span>get(map, key, [])
</span></span><span style=display:flex><span> <span style=color:#a6e22e>Map</span><span style=color:#f92672>.</span>put(map, key, [new <span style=color:#f92672>|</span> record])</span></span></code></pre></div></div><p>Or we can use `Map.update/4`:</p><div class="src src-elixir"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-elixir data-lang=elixir><span style=display:flex><span> <span style=color:#a6e22e>Map</span><span style=color:#f92672>.</span>update(map, key, [], <span style=color:#66d9ef>fn</span> record <span style=color:#f92672>-&gt;</span> [new <span style=color:#f92672>|</span> record] <span style=color:#66d9ef>end</span>)</span></span></code></pre></div></div><p>They are look like as the same completely. But the result is different,
the result by `Map.update/4` of above code is just get the last put in value.
It will only be empty or one item in the list.</p>&mldr;</div><a class=readmore href=//tywhisky.github.io/posts/trap-of-map-update/>Read more ⟶</a></section><section class=list-item><h1 class=title><a href=//tywhisky.github.io/posts/review-2022/>Review 2022</a></h1><time>Dec 27, 2022</time><br><div class=description><p>转眼已经是 2022 年的年末，这一年好像经历了很多事情，但是又好像没完成什么事。</p><div id=outline-container-headline-1 class=outline-2><h2 id=headline-1>Code</h2><div id=outline-text-headline-1 class=outline-text-2><ul><li>今年在工作闲暇之余完成了近 200 道的 Leetcode 算法题（基本来自于 Daily Challenge），马马虎虎吧，重点不在于刷题量，而在于对过往数据结构方面的查漏补缺。</li><li>Advent of Code 2022 依然没能追上脚步，大概落后了有 5 天，毕竟 AOC 比起 Leetcode 在代码量上还是高出不少的，比较花时间。</li><li>新学习的语言只有 Scala ，感兴趣的原因也非常的简单， imperative 和 function 风格相结合的语言我想一定非常适合用来做题吧？ XD。实际上在一定程度上了解这个语言后还是让我很喜欢，希望能在之后的日子里深入学习。</li></ul></div></div><div id=outline-container-headline-2 class=outline-2><h2 id=headline-2>Life</h2><div id=outline-text-headline-2 class=outline-text-2><ul><li>就在彻底开放一个礼拜后我也阳了，但是没有传染给家人，我本人也没有出现发烧等症状。在好了之后继续打了几场羽毛球也没有出现问题，不过目前病毒还在蔓延，比较令人担忧的是病毒势必是不会消失了，往后的日子里可能会不断上演同样的剧情。</li><li>今年的最后两个月搬回了家和爸妈一起住，出来了两年，过往十分熟悉的事情也变得久违。明年我还是会搬出去，所以格外珍惜现在的日子。</li></ul></div></div><div id=outline-container-headline-3 class=outline-2><h2 id=headline-3>Goal</h2><div id=outline-text-headline-3 class=outline-text-2><ul><li>一直以来希望能通过自己的代码去实现一些事情，但是一直都没能找到这个 Point ，希望能在新的一年里做出一些触手可及的，看得见的成果。</li><li>希望自己的英语阅读和口语技能能够上一个台阶，保持目前一直在坚持的英语阅读和练习。</li><li>希望能赚更多的钱，世界很大，有很多想体验的事。</li></ul></div></div>&mldr;</div><a class=readmore href=//tywhisky.github.io/posts/review-2022/>Read more ⟶</a></section><ul class=pagination><span class="page-item page-prev"><a href=//tywhisky.github.io/page/3/ class=page-link aria-label=Previous><span aria-hidden=true>← Prev</span></a>
</span><span class="page-item page-next"><a href=//tywhisky.github.io/page/5/ class=page-link aria-label=Next><span aria-hidden=true>Next →</span></a></span></ul></main><footer><div style=display:flex><a class=soc href=https://github.com/tywhisky rel=me title=GitHub><svg class="feather"><use href="//tywhisky.github.io/svg/feather-sprite.51cf5647cb1987f769b616558f2620fd9423d72058490231b391bf6aa3744b55.svg#github"/></svg></a><a class=border></a></div><div class=footer-info>2026 Tainef | <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></footer></div></body></html>